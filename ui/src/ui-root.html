<link rel="import" href="./lib/intl.html">
<link rel="import" href="./lib/redux-mixin.html">
<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/polymer/lib/elements/dom-if.html">
<link rel="import" href="../../bower_components/app-localize-behavior/app-localize-behavior.html">
<link rel="import" href="../../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="./ui-theme.html">
<link rel="import" href="./initialize-pending.html">
<link rel="import" href="./initialize-passphrase.html">

<dom-module id="ui-root">
  <template>
    <style include="ui-theme"></style>
    <app-header-layout>
      <app-header>
        <app-toolbar>
          <div id="title" main-title>[[localize('app-title')]]</div>
        </app-toolbar>
      </app-header>
      <template is="dom-if" if="[[isPending]]">
        <initialize-pending id="pending"></initialize-pending>
      </template>
      <template is="dom-if" if="[[_initialize(isPending, hasSettings)]]">
        <initialize-passphrase id="initialize"></initialize-passphrase>
      </template>
    </app-header-layout>
  </template>

  <script>
    class UiRoot extends Polymer.mixinBehaviors(
      [Polymer.AppLocalizeBehavior],
      Polymer.ReduxMixin(Polymer.Element)
    ) {
      static get is() {
        return 'ui-root';
      }

      static get properties() {
        return {
          language: {
            value: 'en',
          },
          isPending: {
            type: Boolean,
            statePath: app.isPending,
          },
          hasError: {
            type: Boolean,
            statePath: app.hasError,
          },
          errorText: {
            type: String,
            statePath: app.getErrorText,
          },
          hasSettings: {
            type: Boolean,
            statePath: app.hasSettings,
          },
          isUnlocked: {
            type: Boolean,
            statePath: app.isUnlocked,
          },
          settings: {
            type: Object,
            statePath: app.getSettings,
          },
        };
      }

      static get actions() {
        return {
          initialize: app.initialize,
        };
      }

      attached() {
        this.loadResources(this.resolveUrl('../../locales.json'));
        this.dispatch('initialize');
      }

      _initialize(isPending, hasSettings) {
        return !isPending && !hasSettings;
      }
    }
    window.customElements.define(UiRoot.is, UiRoot);
  </script>
</dom-module>
